package com.symteo.global.config;

import com.symteo.domain.todayMission.entity.Missions;
import com.symteo.domain.todayMission.repository.MissionRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.boot.context.event.ApplicationReadyEvent;
import org.springframework.context.event.EventListener;
import org.springframework.stereotype.Component;
import org.springframework.transaction.annotation.Transactional;

import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;

@Component
@RequiredArgsConstructor
public class MissionDataInitializer {

    private final MissionRepository missionsRepository;

    @EventListener(ApplicationReadyEvent.class)
    @Transactional
    public void initMissions() {
        if (missionsRepository.count() == 0) {
            List<Missions> templates = new ArrayList<>();

            // 기본 미션
            addMissions(templates, "BASIC", "나를 환기하기", List.of(
                    "오늘 하늘을 10초만 바라보고, 지금 떠오르는 감정을 한 문장으로 기록하기",
                    "평소에 무심코 지나치던 길가의 꽃이나 나무를 1분간 자세히 관찰하기",
                    "창문을 열고 들어오는 바람의 냄새와 온도를 느껴보기",
                    "내가 좋아하는 노래 1곡을 틀고, 가사 중 마음에 들어오는 한 줄 적기",
                    "따뜻한 차나 물 한 잔을 아주 천천히 마시며 온기 느껴보기",
                    "내 주변에서 '초록색' 물건을 3가지 찾아보고 사진 찍기",
                    "샤워할 때 물줄기의 소리와 느낌에만 온전히 집중해보기",
                    "오늘 먹은 음식 중 가장 맛있는 한 입을 음미하며 먹기",
                    "스스로의 어깨나 팔을 토닥토닥 1분간 안마해주기",
                    "가장 좋아하는 향기(커피, 비누 등)를 맡으며 크게 심호흡하기"
            ));

            addMissions(templates, "BASIC", "마음 돌보기", List.of(
                    "거울을 보면서 나에게 “오늘도 고마워”라고 소리 내어 말해보기",
                    "오늘 하루, 나의 행동 1개를 찾아서 칭찬하기",
                    "“지금 내가 제일 듣고 싶은 말”을 내 입장에서 적어주기",
                    "내가 요즘 정말 잘하고 있는 점 1개를 적기",
                    "내가 어릴 때 좋아했던 것 1개 떠올리고, 지금도 좋아하는지 해보기",
                    "오늘의 나에게 점수를 준다면 몇 점인지 적고, 그 이유 1줄 적기",
                    "“내가 지켜온 것” 1개를 적고, 그걸 지킨 내가 대단한 이유 적기",
                    "내가 최근에 ‘억지로 괜찮은 척했던 순간’을 적고 솔직한 감정 붙여주기",
                    "지금 내 감정을 날씨로 표현해서 기록해보기",
                    "한 달 뒤의 나에게 딱 한 문장으로 짧은 편지 쓰기"
            ));

            addMissions(templates, "BASIC", "생각 정리하기", List.of(
                    "요즘 가장 나를 지치게 하는 생각 1개를 적고, “그 생각을 안 해도 되는 이유” 적기",
                    "나를 불안하게 만드는 상황에서 ‘내가 원래 잘하던 행동’ 1개 적기",
                    "나를 힘들게 했던 말을 하나 떠올리고, 그 말이 틀렸던 이유 적기",
                    "“지금 당장 해결 못 해도 괜찮은 일” 1개를 적고 내려놓기",
                    "요즘 나를 가장 힘들게 하는 사람/상황을 떠올리고, 내가 지키고 싶은 선 1개 정하기",
                    "오늘 가장 편안했던 순간을 1개 떠올리고 ‘왜 편했는지’ 적기",
                    "오늘 하루 중 가장 나답지 않았던 순간을 적고, 이유를 분석해보기",
                    "내가 최근에 가장 많이 참았던 감정이 뭔지 적어보기",
                    "내가 지금 제일 필요한 것은 ‘위로/휴식/변화/용기’ 중 무엇인지 고르기",
                    "내가 자꾸 비교하는 대상이 있다면, 비교 대신 나만의 기준 1개 만들기",
                    "내가 앞으로 덜 힘들어지기 위해 내일 딱 하나만 바꾸고 싶은 행동 정하기",
                    "나를 힘들게 하는 걱정거리를 종이에 적고, 구겨서 쓰레기통에 버리기"
            ));

            addMissions(templates, "BASIC", "마음 나누기", List.of(
                    "부모님께 “우리 가족이 가장 행복했던 순간이 언제였어?” 물어보기",
                    "친구에게 “내 장점 3개만 솔직히 말해줘”라고 보내보기",
                    "내가 고마웠던 사람 1명을 떠올리고, 마음속으로 감사 1줄 보내기",
                    "내가 힘들 때 옆에 있어준 사람을 떠올리고, 그 장면을 글로 적기",
                    "가장 미안한 사람이 있다면 ‘미안했던 이유’만 적어보기",
                    "“요즘 나를 제일 이해해주는 사람”이 누구인지 적기",
                    "오늘 누군가에게 한 번만 따뜻한 말 걸기",
                    "내가 소중하게 생각하는 사람에게 “너 요즘 어때?” 한 마디 보내기",
                    "요즘 연락이 뜸했던 사람 1명에게 안부 보내기",
                    "지인에게 \"나를 생각하면 떠오르는 노래가 있어?\"라고 물어보고 들어보기",
                    "가족이나 친구의 뒷모습을 보며 마음속으로 응원 보내기",
                    "내가 좋아하는 사람의 장점 3가지를 찾아서 말해주기"
            ));

            // === 2. 우울/불안 높은 경우 (DEP_ANX) ===
            addMissions(templates, "DEP_ANX", "불안 낮추기", List.of(
                    "지금 보이는 것 3개 / 들리는 것 2개 / 느껴지는 것 1개를 적어보기",
                    "손바닥을 가슴에 얹고 5분간 \"괜찮아\"라고 말하며 토닥이며 격려해주기",
                    "숨을 4초 들이마시고 6초 내쉬는 호흡을 5분만 반복하기",
                    "찬물로 손을 20초 씻으면서 '물의 감각'에만 집중해보기",
                    "내 몸에서 지금 긴장된 부위를 찾아 10초만 힘 빼보기"
            ));

            addMissions(templates, "DEP_ANX", "생각 정리", List.of(
                    "머릿속을 꽉 채운 생각을 '필터 없이' 5줄만 써보기",
                    "내 걱정 중 \"지금 당장 해결 가능한 것 1개 / 아닌 것 1개\" 나누기",
                    "불안한 생각을 한 문장으로 쓰고, 그 생각의 증거/반증을 1개씩 적기",
                    "오늘 가장 괴로운 생각에 제목 붙이기",
                    "지금 떠오르는 최악의 시나리오를 적고, 현실적인 가능성을 %로 써보기",
                    "\"내가 통제할 수 있는 것 1개 / 없는 것 1개\"를 구분해 적기"
            ));

            addMissions(templates, "DEP_ANX", "자책 완화", List.of(
                    "지금의 나에게 필요한 말이 있다면 딱 1문장만 적어주기",
                    "오늘 '완벽하지 않아도 괜찮은 이유' 1개를 써보기",
                    "내가 오늘 해낸 가장 작은 생존 행동 1개를 찾아 칭찬하기",
                    "\"내가 못한 것\" 대신 \"내가 버틴 것\"을 1개 적기",
                    "내가 나에게 너무 심하게 말했던 문장을 적고, 더 부드러운 문장으로 바꿔쓰기",
                    "친구가 같은 상황이라면 해줄 위로를 '나에게' 그대로 적어주기"
            ));

            addMissions(templates, "DEP_ANX", "작은 행동", List.of(
                    "지금 할 수 있는 가장 쉬운 '정리 1개'만 하기 (예: 책상 위 쓰레기 하나)",
                    "물 한 컵을 천천히 마시고 \"나는 나를 돌보고 있다\"라고 적기",
                    "창문을 열거나 밖 공기를 10초만 맡기",
                    "침대 위에서라도 몸을 좌우로 천천히 5번만 움직이기",
                    "\"지금 당장 1분만 할 수 있는 일\"을 정해서 실행하고 체크하기",
                    "오늘 해야 하는 것 중 하나를 \"5분 버전\"으로 줄여서 해보기"
            ));

            addMissions(templates, "DEP_ANX", "감정 해소", List.of(
                    "지금 감정을 색깔로 표현하고, 그 색을 고른 이유를 적기",
                    "울고 싶다면 참지 말고 '울어도 되는 이유' 1개 적어 허락해주기",
                    "내 마음이 가장 무너졌던 순간을 떠올리고 \"그때 내가 필요했던 것\" 적기",
                    "오늘 마음이 무거운 이유를 3단어로 줄여 적기 (예: 불안/외로움/피곤)",
                    "\"나를 가장 힘들게 하는 말\"을 적고, 그 말에 반박 1줄 적기",
                    "오늘 나를 지켜주기 위해 '하지 않아도 되는 것' 1개를 정해 허락하기"
            ));

            // === 3. 스트레스 높은 경우 (STRESS) ===
            addMissions(templates, "STRESS", "로그아웃", List.of(
                    "잠들기 30분 전, 핸드폰을 ‘방해 금지 모드’나 ‘무음’으로 설정하기",
                    "오늘 점심시간(혹은 식사 시간)에는 핸드폰 화면을 보지 않고 밥맛에만 집중하기",
                    "출퇴근길이나 이동 중에 이어폰을 빼고, 주변 소음이나 정적을 5분간 느껴보기",
                    "지금 켜져 있는 컴퓨터 인터넷 창이나 스마트폰 앱 중, 당장 필요 없는 3개 끄기",
                    "멍 때리기: 3분 동안 아무것도 하지 않고 벽이나 허공을 바라보기",
                    "SNS 알림 배지(빨간 숫자)가 안 보이게 폴더에 넣거나 알림 끄기",
                    "눈을 감고 양손으로 눈을 덮어 1분간 ‘완전한 어둠’ 만들기"
            ));

            addMissions(templates, "STRESS", "멈춤과 경계", List.of(
                    "오늘 누군가의 부탁이나 제안에 바로 답하지 않고 “스케줄 확인해보고 알려줄게”라고 말하기",
                    "“이 정도면 충분해”라고 소리 내어 말하고, 수정하고 싶은 욕구 1번 참기",
                    "오늘의 ‘할 일 목록(To-do List)’에서 굳이 오늘 안 해도 되는 1가지를 지워버리기",
                    "퇴근(혹은 일과 종료) 후에는 업무/학업과 관련된 연락이나 생각 1번 의도적으로 무시하기",
                    "나를 조급하게 만드는 사람이나 상황에서 의도적으로 한 박자 천천히 대답하기",
                    "싫은 것은 싫다고, 혹은 힘들면 힘들다고 아주 작게라도 표현해보기",
                    "오늘만큼은 '빠르게' 걷지 않고, 평소보다 0.5배속으로 천천히 걸어보기"
            ));

            addMissions(templates, "STRESS", "몸의 긴장 풀기", List.of(
                    "따뜻한 물로 샤워하거나 족욕을 하며, 긴장이 녹아내리는 상상하기",
                    "목 뒤와 어깨가 굳어있는지 확인하고, 크게 한숨 쉬며 어깨 툭 떨어트리기",
                    "미간에 잡힌 주름을 의식하고, 눈썹 사이를 손가락으로 문질러 펴주기",
                    "좋아하는 향(디퓨저, 섬유유연제 등)을 깊게 들이마시고 5초간 숨 참았다 내뱉기",
                    "딱딱한 신발을 벗고, 발가락을 쫙 폈다가 오므리는 것을 10회 반복하기",
                    "자기 전에 다리를 벽에 기대고 L자 모양으로 5분간 올려두기",
                    "오늘 마시는 커피/음료의 첫 모금은 3초 이상 머금고 맛을 완전히 느낀 뒤 삼키기"
            ));

            addMissions(templates, "STRESS", "나를 위한 처방", List.of(
                    "오늘 점심이나 저녁 메뉴는 ‘가성비’ 말고 오직 ‘내가 먹고 싶은 것’으로 고르기",
                    "나에게 스트레스를 주는 대상(사람/일)을 종이에 적고, 그것과 물리적 거리두기 상상하기",
                    "유튜브나 넷플릭스에서 '생각 없이 웃을 수 있는' 짧은 영상 1편 보기",
                    "오늘 하루 중 단 10분이라도, 누구의 방해도 받지 않는 '나만의 동굴' 시간 갖기",
                    "지금 당장 떠나고 싶은 여행지 사진을 검색해서 1분간 감상하기",
                    "“내가 다 해결하지 않아도 세상은 잘 돌아간다”라고 스스로에게 말해주기",
                    "가장 편한 옷(잠옷, 트레이닝복)으로 갈아입고 침대에 대자로 뻗어보기",
                    "오늘 하루, 거울을 볼 때 내 외모를 평가하지 않고 그냥 ‘안녕’ 하고 웃어주기",
                    "나를 위한 작은 사치(비싼 커피, 택시 타기 등)를 하나 허용해주기"
            ));

            missionsRepository.saveAll(templates);
        }
    }

    private void addMissions(List<Missions> list, String category, String sub, List<String> contents) {
        for (String content : contents) {
            list.add(Missions.builder()
                    .category(category)
                    .subCategory(sub)
                    .missionContents(content)
                    .deadLine(LocalDateTime.of(9999, 12, 31, 14, 00)) // 템플릿용 미래 기한
                    .build());
        }
    }
}
